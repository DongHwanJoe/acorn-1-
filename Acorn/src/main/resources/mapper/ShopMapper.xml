<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="shop">

   <sql id="searchCondition">
      <choose>
         <when test="title != null">
            WHERE title LIKE '%'||#{title}||'%'
         </when>
         <when test="categorie != null">
            WHERE title LIKE '%'||#{categorie}||'%'
         </when>
      </choose>
   </sql>
   
	<insert id="insert" parameterType="shopDto">
		insert into board_shop
		(num,title,content,imagePath,categorie,reviewCount,likeCount,dislikeCount,telNum,addr,latitude,longitude)
		values(board_shop_seq.nextval, #{title}, #{content}, #{imagePath}, #{categorie}, 0, 0, 0, #{telNum}, #{addr}, 0, 0)
	</insert>
	
	<delete id="delete" parameterType="int">
		delete from board_shop
		where num=#{num}
	</delete>
	
	<update id="update" parameterType="shopDto">
		update board_shop
		set title=#{title}, content=#{content}, imagePath=#{imagePath}, categorie=#{categorie}, telNum=#{telNum}, addr=#{addr}
		where num=#{num}
	</update>
	
	<select id="getCount" parameterType="ShopDto" resultType="int">
      SELECT NVL(MAX(ROWNUM), 0)
      FROM board_shop
      <include refid="searchCondition"/>
    </select>   

	<update id="addReviewCount" parameterType="int">
		update board_shop
		set reviewCount=reviewCount+1
		where num=#{num}
	</update>
	
	<update id="likeUp" parameterType="int">
		update board_shop
		set likeCount=likeCount+1
		where num=#{num}
	</update>
	
	<update id="dislikeUp" parameterType="int">
		update board_shop
		set dislikeCount=dislikeCount+1
		where num=#{num}
	</update>
      <select id="getList" resultType="shopDto">
      
      SELECT *
      FROM
         (SELECT result1.*, ROWNUM AS rnum
         FROM
            (SELECT num,title,content,imagePath,categorie,
      			reviewCount,likeCount,dislikeCount,telNum,addr,latitude,longitude
      		from board_shop
            <include refid="searchCondition"/>
            ORDER BY num DESC) result1)
      <![CDATA[ 
      WHERE rnum >= #{startRowNum} AND rnum <= #{endRowNum}
      ]]>
   </select>
   <select id="getData" parameterType="int" resultType="shopDto">
   		select num,title,content,imagePath,categorie,
      		reviewCount,likeCount,dislikeCount,telNum,addr,latitude,longitude
     	from board_shop
     	where num=#{num}
   </select>
   
   <select id="getData2" parameterType="shopDto" resultType="shopDto">
   		select result1.*
	   		from	(select num,title,content,imagePath,categorie,
	      		reviewCount,likeCount,dislikeCount,telNum,addr,latitude,longitude
	     	from board_shop
	     	<include refid="searchCondition"/>
	     	) result1
     	where num=#{num}
   </select>
</mapper>